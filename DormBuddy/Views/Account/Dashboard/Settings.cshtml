@{
    ViewData["Title"] = "Account Settings";
}

<div class="text-center mb-4">
    <h1 class="display-4">Account Settings</h1>
    <p>Update your account information and preferences.</p>
</div>

<div class="settings-container">
    <!-- Navigation Buttons -->
    <div id="navigationButtons">
        <button id="general-settings-btn" class="settings-btn" onclick="loadSettings('GeneralSettings')" style="background-color: rgb(89, 199, 226); color: white; border: none;">General Settings</button>
        <button id="account-settings-btn" class="settings-btn" onclick="loadSettings('AccountSettings')" style="background-color: rgb(255, 79, 152); color: white; border: none;">Account Settings</button>
        <button id="privacy-settings-btn" class="settings-btn" onclick="loadSettings('PrivacySettings')" style="background-color: rgb(154, 154, 240); color: white; border: none;">Privacy Settings</button>
        <button id="profile-settings-btn" class="settings-btn" onclick="loadSettings('ProfileSettings')" style="background-color: rgb(180, 150, 100); color: white; border: none;">Profile Settings</button>
    </div>

    <!-- Content Area to Display the Settings -->
    <div id="settings-content">
        <!-- Default to 'GeneralSettings' content load -->
    </div>
</div>

@section Scripts {
    <script type="text/javascript">

        function updateActiveButton(activeButton) {
            $('#navigationButtons button').each(function() {
                $(this).css('opacity', '.8'); // Reset all button colors
            });
            $(activeButton).css('opacity', '1.0'); // Change background for active button
        }
        // Function to load settings dynamically
        function loadSettings(page) {

            var urlParams = new URLSearchParams(window.location.search);

            // Default empty string for errorMessage
            var errorMessage = "";

            // Check if 'errorMessage' exists in the query string
            if (urlParams.has('errorMessage')) {
                errorMessage = urlParams.get('errorMessage');
            }

            $.ajax({
                url: '@Url.Action("LoadSettings")',
                type: 'GET',
                data: { settingsPage: page, errorMessage: errorMessage },
                cache: false,
                success: function (data) {
                    $('#settings-content').html(data); // Load the settings view into the content area

                    $(window).trigger('resize');
                    

                    let pageName = page.toLowerCase().replace("settings", "");

                    //alert(pageName);

                    updateActiveButton('#' + pageName + '-settings-btn');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("Error loading settings. Status: " + textStatus + ", Error: " + errorThrown);
                }
            });
        }

        // Initially load settings based on ViewBag.LoadPage
        $(document).ready(function() {
            var initialPage = '@ViewBag.LoadPage';
            if (initialPage) {
                loadSettings(initialPage);
            } else {
                loadSettings('GeneralSettings'); // Default to general settings
            }
        });
    </script>
}
